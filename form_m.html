<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form M - Monthly Utilization</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: "Times New Roman", Times, serif; 
            margin: 0; padding: 0; 
            background-color: #555; 
            font-size: 10pt; 
        }
        
        .page { 
            background: white; 
            width: 210mm; 
            height: 297mm; /* Fixed A4 Height */
            margin: 20px auto; 
            padding: 10mm 10mm 5mm 10mm; 
            position: relative; 
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            overflow: hidden; 
            display: flex;
            flex-direction: column;
        }

        /* Settings Bar */
        .settings-bar { background: #222; color: white; padding: 10px; text-align: center; font-family: sans-serif; }
        .settings-btn { background: #d9534f; color: white; border: none; padding: 5px 15px; cursor: pointer; font-weight: bold; margin-left: 10px; border-radius: 3px; }
        .print-btn { background: white; color: black; border: none; padding: 5px 15px; cursor: pointer; font-weight: bold; margin-left: 10px; border-radius: 3px; }

        /* Main Watermark (Background) */
        .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.08; pointer-events: none; width: 70%; z-index: 0; }

        /* DEVELOPER WATERMARK (Safe Zone) */
        .dev-watermark {
            text-align: right;
            font-family: 'Courier New', monospace;
            font-size: 10pt;
            font-weight: bold;
            color: #000;
            margin-top: 20px; /* 2cm space (approx) below signatures */
            margin-right: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            z-index: 10;
        }

        /* Inputs */
        input { border: none; background: rgba(255, 255, 0, 0.05); font-family: inherit; font-size: inherit; width: 100%; padding: 0; text-align: center; height: 100%; }
        input:focus { background: rgba(255, 255, 0, 0.2); outline: none; }
        .line-input { border-bottom: 1px dotted #000; background: transparent; text-align: left; padding-left: 5px; }
        .box-input { border: 1px solid #000; text-align: center; height: 18px; }
        input.readonly { background-color: #f0f0f0; font-weight: bold; color: #333; }

        /* Header */
        .header { display: flex; align-items: center; margin-bottom: 5px; position: relative; z-index: 1; border-bottom: 1px solid #000; padding-bottom: 5px; }
        .logo { width: 50px; height: 50px; border: 1px solid #fff; margin-right: 10px; display: flex; align-items: center; justify-content: center; }
        .logo img { max-width: 100%; max-height: 100%; }
        .title-block { flex: 1; text-align: center; }
        .title-block h2 { margin: 0; font-size: 13pt; font-weight: bold; text-transform: uppercase; }
        .title-block h3 { margin: 0; font-size: 10pt; font-weight: normal; }
        .title-block h4 { margin: 2px 0 0 0; font-size: 10pt; font-weight: bold; text-decoration: underline; }
        .form-box { border: 2px solid #000; padding: 3px 6px; font-weight: bold; font-size: 9pt; white-space: nowrap; margin-left: 10px; }

        /* Rows */
        .row { display: flex; margin-bottom: 3px; align-items: center; position: relative; z-index: 1; }
        .label { white-space: nowrap; margin-right: 5px; font-weight: bold; font-size: 10pt; }
        
        /* Grid Boxes */
        .grid-row { display: flex; margin-bottom: 5px; align-items: center; position: relative; z-index: 1; }
        .box-container { display: flex; border: 1px solid #000; height: 20px; background: white; }
        .box-cell { width: 20px; border-right: 1px solid #000; }
        .box-cell:last-child { border-right: none; }

        /* Spread Row (Prevents Overlap) */
        .spread-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
            width: 100%;
        }

        /* Tables */
        .section-header { text-align: center; font-weight: bold; background: #ddd; border: 1px solid #000; padding: 2px; margin-top: 5px; font-size: 9pt; position: relative; z-index: 1; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 2px; position: relative; z-index: 1; }
        th, td { border: 1px solid #000; padding: 2px 4px; font-size: 9.5pt; height: 18px; }
        th { background: #f9f9f9; font-weight: bold; text-align: center; vertical-align: middle; padding: 0; font-size: 9pt; }
        td.label-col { width: 25%; text-align: left; padding-left: 5px; font-weight: bold; }
        
        /* Footer */
        .footer-text { margin-top: 10px; font-size: 10pt; line-height: 1.4; position: relative; z-index: 1; text-align: justify; }
        .sig-row { display: flex; justify-content: space-between; margin-top: 35px; position: relative; z-index: 1; }
        .sig-box { text-align: center; width: 200px; border-top: 1px solid #000; padding-top: 2px; font-size: 9pt; }

        @media print {
            @page { size: A4 portrait; margin: 0; }
            body { background: white; margin: 0; padding: 0; }
            .page { width: 210mm; height: 297mm; margin: 0; padding: 10mm; box-shadow: none; border: none; page-break-after: avoid; page-break-inside: avoid; }
            .settings-bar { display: none !important; }
            input { background: transparent !important; }
            input.readonly { background: transparent !important; }
            .watermark { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            table, tr, td, div { page-break-inside: avoid; }
        }
    </style>
</head>
<body>

<div class="settings-bar">
    <strong>MEMORY MODE</strong>
    <button class="settings-btn" onclick="clearData()">üóëÔ∏è CLEAR DATA</button>
    <button class="print-btn" onclick="window.print()">üñ®Ô∏è PRINT PDF</button>
</div>

<div class="page">
    <div class="watermark"><svg viewBox="0 0 500 500"><text x="50%" y="50%" fill="#000" font-size="60" font-weight="bold" font-family="Arial" text-anchor="middle" transform="rotate(-45 250 250)">PM POSHAN</text><text x="50%" y="65%" fill="#000" font-size="40" font-family="Arial" text-anchor="middle" transform="rotate(-45 250 250)">W.B. GOVT</text></svg></div>

    <div class="header">
        <div class="logo"><img src="logo.png" alt="LOGO"></div>
        <div class="title-block">
            <h2>Cooked Mid Day Meal Programme</h2>
            <h3>School Education Department, Government of West Bengal</h3>
            <h4>Month Wise Utilization</h4>
            <div style="font-size: 9pt; font-weight: normal;">[To be filled up in English Block Capital in only]</div>
        </div>
        <div class="form-box">Form - M</div>
    </div>

    <div class="row"><div class="label">For the Month</div><input type="text" class="line-input" id="u_month"><div class="label" style="margin-left:10px;">Year</div><input type="text" class="line-input" style="width: 60px;" id="u_year"></div>
    <div class="row"><div class="label">District</div><input type="text" class="line-input" id="u_dist"><div class="label" style="margin-left:10px;">Sub-Division</div><input type="text" class="line-input" id="u_subdiv"></div>
    <div class="row"><div class="label">Block/Municipality</div><input type="text" class="line-input" id="u_block"><div class="label" style="margin-left:10px;">Name of G.P/Ward</div><input type="text" class="line-input" id="u_gp"></div>
    <div class="row"><div class="label">Name of School/ SSK/MSK/Madrasah</div><input type="text" class="line-input" id="u_school"></div>

    <div class="grid-row" style="margin-top: 10px;">
        <div class="label" style="width: 100px;">DISE Code</div>
        <div class="box-container" id="dise_container"></div>
    </div>

    <div class="spread-row" style="margin-top: 5px;">
        <div class="label">No. of Cooking Days</div>
        <div class="box-container" style="width: 70px;"><div class="box-cell" style="width:100%"><input id="u_cook_days"></div></div>
        
        <div class="label">No. of MDM takers</div>
        <div class="box-container" style="width: 120px;"><div class="box-cell" style="width:100%"><input id="u_mdm_takers"></div></div>
    </div>

    <div class="row" style="margin-top: 5px;">
        <div class="label">Name of Self Help Group</div>
        <input type="text" class="box-input" style="text-align: left; padding-left: 5px; height: 22px; flex: 1;" id="u_shg_name">
    </div>
    
    <div class="grid-row">
        <div class="label" style="width: 90px;">Bank Name</div>
        <input type="text" class="box-input" style="width: 150px; height: 22px;" id="u_bank_name">
        <div class="label" style="width: 90px; margin-left: 10px;">Account No.</div>
        <div class="box-container" style="flex:1;" id="acc_container"></div>
    </div>

    <div class="section-header">FOOD GRAINS UTILIZATION</div>
    <table>
        <thead>
            <tr><th style="width: 20%;">Category</th><th>Opening balance<br>(Kg)</th><th>Received<br>(Kg)</th><th>Utilized<br>(Kg)</th><th>Closing balance<br>(Kg)</th></tr>
        </thead>
        <tbody>
            <tr><td class="label-col">Bal Vatika:</td><td><input type="number" id="rice_bv_open" oninput="calcRice()"></td><td><input type="number" id="rice_bv_recv" oninput="calcRice()"></td><td><input type="number" id="rice_bv_util" oninput="calcRice()"></td><td><input type="number" id="rice_bv_close" class="readonly" readonly></td></tr>
            <tr><td class="label-col">Class I-V:</td><td><input type="number" id="rice_iv_open" oninput="calcRice()"></td><td><input type="number" id="rice_iv_recv" oninput="calcRice()"></td><td><input type="number" id="rice_iv_util" oninput="calcRice()"></td><td><input type="number" id="rice_iv_close" class="readonly" readonly></td></tr>
        </tbody>
    </table>

    <div class="section-header" style="margin-top: 5px;">COOKING COST UTILIZATION</div>
    <table>
        <thead>
            <tr><th style="width: 20%;">Category</th><th>Opening balance<br>(Rs)</th><th>Received<br>(Rs)</th><th>Utilized<br>(Rs)</th><th>Closing balance<br>(Rs)</th></tr>
        </thead>
        <tbody>
            <tr><td class="label-col">Bal Vatika:</td><td><input type="number" id="cost_bv_open" oninput="calcCost()"></td><td><input type="number" id="cost_bv_recv" oninput="calcCost()"></td><td><input type="number" id="cost_bv_util" oninput="calcCost()"></td><td><input type="number" id="cost_bv_close" class="readonly" readonly></td></tr>
            <tr><td class="label-col">Class I-V:</td><td><input type="number" id="cost_iv_open" oninput="calcCost()"></td><td><input type="number" id="cost_iv_recv" oninput="calcCost()"></td><td><input type="number" id="cost_iv_util" oninput="calcCost()"></td><td><input type="number" id="cost_iv_close" class="readonly" readonly></td></tr>
        </tbody>
    </table>

    <div class="section-header" style="margin-top: 5px;">OTHER EXPENDITURE</div>
    <table>
        <thead><tr><th style="width: 30%;">Items</th><th style="width: 40%;">Quantity</th><th style="width: 30%;">Cost (Rs)</th></tr></thead>
        <tbody>
            <tr><td class="label-col">Vegetable</td><td style="display:flex;"><input id="qty_veg"><span>KG</span></td><td><input type="number" id="exp_veg" oninput="calcExp()"></td></tr>
            <tr><td class="label-col">Pulse</td><td style="display:flex;"><input id="qty_pulse"><span>KG</span></td><td><input type="number" id="exp_pulse" oninput="calcExp()"></td></tr>
            <tr><td class="label-col">Oil</td><td style="display:flex;"><input id="qty_oil"><span>KG</span></td><td><input type="number" id="exp_oil" oninput="calcExp()"></td></tr>
            <tr><td class="label-col">Spice</td><td style="display:flex;"><input id="qty_spice"><span>KG</span></td><td><input type="number" id="exp_spice" oninput="calcExp()"></td></tr>
            <tr><td class="label-col">Soya bean</td><td style="display:flex;"><input id="qty_soya"><span>KG</span></td><td><input type="number" id="exp_soya" oninput="calcExp()"></td></tr>
            <tr><td class="label-col">Fuel</td><td style="display:flex;"><input id="qty_fuel"><span>KG</span></td><td><input type="number" id="exp_fuel" oninput="calcExp()"></td></tr>
            <tr><td class="label-col">Others</td><td style="display:flex;"><input id="qty_other"><span>KG</span></td><td><input type="number" id="exp_other" oninput="calcExp()"></td></tr>
            <tr style="background: #eee; font-weight: bold;"><td colspan="2" style="text-align: right; padding-right: 10px;">Total Expenditure</td><td><input type="number" id="exp_total" class="readonly" readonly></td></tr>
            <tr><td colspan="2" style="text-align: right; padding-right: 10px; font-weight: bold;">Honorarium for SHG</td><td><input type="number" id="exp_honorarium" oninput="calcExp()"></td></tr>
            <tr style="background: #ddd; font-weight: bold; border-top: 2px solid #000;"><td colspan="2" style="text-align: right; padding-right: 10px;">Grand Total Expenditure:</td><td><input type="number" id="exp_grand_total" class="readonly" readonly></td></tr>
        </tbody>
    </table>

    <div class="footer-text">
        (You are therefore requested to please remit the aforesaid amount of Rs. 
        <input type="text" class="line-input" style="width: 100px; font-weight: bold;" id="u_remit_amt"> 
        spent by us to our Bank Account as early as possible and obliged.)
    </div>

    <div class="sig-row">
        <div class="sig-box">Head Teacher/ Teacher-in-Charge along with Seal</div>
        <div class="sig-box">Signature & Seal of the Group Leader</div>
    </div>

    <div class="dev-watermark">Developed by Jyotirmoy Ghosh</div>
</div>

<script>
    window.onload = function() {
        createBoxes('dise_container', 11, 'dise');
        createBoxes('acc_container', 16, 'acc');
        loadData();
    };

    function createBoxes(id, n, prefix) {
        let c = document.getElementById(id);
        for(let i=1; i<=n; i++) {
            let d = document.createElement('div');
            d.className = 'box-cell';
            if(prefix === 'acc') d.style.width = "100%";
            d.innerHTML = `<input id="${prefix}_${i}" maxlength="1" oninput="saveData()">`;
            c.appendChild(d);
        }
    }

    function calcRice() {
        ['bv', 'iv'].forEach(g => {
            let o = parseFloat(document.getElementById(`rice_${g}_open`).value)||0;
            let r = parseFloat(document.getElementById(`rice_${g}_recv`).value)||0;
            let u = parseFloat(document.getElementById(`rice_${g}_util`).value)||0;
            document.getElementById(`rice_${g}_close`).value = (o+r-u).toFixed(2);
        });
        saveData();
    }
    function calcCost() {
        ['bv', 'iv'].forEach(g => {
            let o = parseFloat(document.getElementById(`cost_${g}_open`).value)||0;
            let r = parseFloat(document.getElementById(`cost_${g}_recv`).value)||0;
            let u = parseFloat(document.getElementById(`cost_${g}_util`).value)||0;
            document.getElementById(`cost_${g}_close`).value = (o+r-u).toFixed(2);
        });
        saveData();
    }
    function calcExp() {
        let tot = 0;
        ['veg','pulse','oil','spice','soya','fuel','other'].forEach(i => tot += parseFloat(document.getElementById(`exp_${i}`).value)||0);
        document.getElementById('exp_total').value = tot.toFixed(2);
        let hon = parseFloat(document.getElementById('exp_honorarium').value)||0;
        document.getElementById('exp_grand_total').value = (tot+hon).toFixed(2);
        saveData();
    }
    function saveData() {
        let data = {};
        document.querySelectorAll('input').forEach(i => { if(i.id) data[i.id] = i.value; });
        localStorage.setItem('mdm_form_m_final', JSON.stringify(data));
    }
    function loadData() {
        let d = JSON.parse(localStorage.getItem('mdm_form_m_final'));
        if(d) {
            for(let k in d) if(document.getElementById(k)) document.getElementById(k).value = d[k];
            calcRice(); calcCost(); calcExp();
        }
    }
    function clearData() {
        if(confirm("Clear All?")) { localStorage.removeItem('mdm_form_m_final'); location.reload(); }
    }
</script>
</body>
</html>
