<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form C - Monthly Coverage</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: "Times New Roman", Times, serif; 
            margin: 0; padding: 0; 
            background-color: #555; 
            font-size: 9pt; 
        }
        
        .page { 
            background: white; 
            width: 210mm; 
            height: 297mm; /* Fixed A4 Height */
            margin: 20px auto; 
            padding: 8mm; /* Tight margins */
            position: relative; 
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            overflow: hidden; 
            display: flex;
            flex-direction: column;
        }

        /* Settings Bar */
        .settings-bar { background: #222; color: white; padding: 10px; text-align: center; font-family: sans-serif; }
        .settings-bar input { width: 50px; text-align: center; background: white; color: black; border: none; padding: 2px; }
        .btn { border: none; padding: 5px 15px; cursor: pointer; font-weight: bold; margin-left: 10px; border-radius: 3px; }
        .btn-clear { background: #d9534f; color: white; }
        .btn-print { background: white; color: black; }

        /* Main Watermark */
        .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.08; pointer-events: none; width: 70%; z-index: 0; }

        /* DEVELOPER WATERMARK */
        .dev-watermark {
            text-align: right;
            font-family: 'Courier New', monospace;
            font-size: 10pt;
            font-weight: bold;
            color: #000;
            margin-top: 5px; 
            margin-right: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            z-index: 10;
        }

        /* Inputs */
        input { border: none; background: rgba(255, 255, 0, 0.05); font-family: inherit; font-size: inherit; width: 100%; padding: 0; text-align: center; height: 100%; }
        input:focus { background: rgba(255, 255, 0, 0.2); outline: none; }
        .line-input { border-bottom: 1px dotted #000; background: transparent; text-align: left; padding-left: 5px; }
        input.readonly { background-color: #f0f0f0; font-weight: bold; color: #333; }
        input.footer-auto { background-color: #e8f0fe; font-weight: bold; }

        /* --- DATE ARROW REMOVER (GLOBAL) --- */
        input[type="date"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        /* Hides the arrow in Chrome/Android */
        input[type="date"]::-webkit-calendar-picker-indicator {
            display: none !important;
            -webkit-appearance: none !important;
            background: transparent;
        }
        /* Ensures text stays centered */
        input[type="date"]::-webkit-date-and-time-value {
            text-align: center; 
        }

        /* Header */
        .header { display: flex; align-items: flex-start; margin-bottom: 5px; position: relative; z-index: 1; }
        .logo { width: 50px; height: 50px; border: 1px solid #eee; text-align: center; display: flex; align-items: center; justify-content: center; } 
        .logo img { max-width: 100%; max-height: 100%; }
        .title-block { flex: 1; text-align: center; }
        .title-block h2 { margin: 0; font-size: 11pt; text-transform: uppercase; font-weight: bold; }
        .title-block h3 { margin: 0; font-size: 9pt; font-weight: normal; }
        .title-block h4 { margin: 0; font-size: 9pt; font-weight: bold; }
        .form-box { border: 2px solid #000; padding: 2px 5px; font-weight: bold; margin-left: 5px; white-space: nowrap; font-size: 9pt; height: fit-content; }
        .sub-header { text-align: center; font-weight: bold; margin: 2px 0; font-size: 8pt; }

        /* Info Fields */
        .field-row { display: flex; margin-bottom: 2px; align-items: baseline; position: relative; z-index: 1; }
        .field-label { white-space: nowrap; margin-right: 5px; }
        .field-input { flex: 1; }

        /* Enrollment Section */
        .enrollment-section { margin: 2px 0; position: relative; z-index: 1; font-size: 8pt; }
        .enroll-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1px; }
        .box-group { display: inline-flex; gap: 0; }
        .num-box { width: 16px; height: 16px; border: 1px solid #000; margin-right: -1px; background: white; }
        .split-row { display: flex; justify-content: space-between; margin-bottom: 1px; }
        .half-row { display: flex; justify-content: space-between; align-items: center; width: 49%; }

        /* Main Table */
        table { width: 100%; border-collapse: collapse; font-size: 7.5pt; position: relative; z-index: 1; margin-bottom: 2px; }
        th, td { border: 1px solid #000; padding: 0; text-align: center; height: 15px; overflow: hidden; }
        th { font-weight: bold; line-height: 1; background-color: #fff; vertical-align: middle; height: auto; padding: 2px 0;}
        .col-sl { width: 18px; } .col-date { width: 45px; } .col-total { background-color: #f5f5f5; }

        /* Footer Section */
        .footer { font-size: 8pt; margin-top: auto; line-height: 1.2; position: relative; z-index: 1; }
        .sig-block { margin-top: 15px; display: flex; justify-content: flex-end; }
        .sig-line { border-top: 1px solid #000; width: 180px; text-align: center; padding-top: 2px; }

        @media print {
            @page { size: A4 portrait; margin: 0; }
            body { background: white; margin: 0; padding: 0; }
            .page { width: 210mm; height: 297mm; margin: 0; padding: 8mm; box-shadow: none; border: none; page-break-after: avoid; }
            .settings-bar { display: none !important; }
            input { background: transparent !important; }
            input.readonly, input.footer-auto { background-color: transparent !important; font-weight: bold; }
            .watermark { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .dev-watermark { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            table, tr, td, .footer { page-break-inside: avoid; }
        }
    </style>
</head>
<body>

<div class="settings-bar">
    <strong>SETTINGS:</strong>
    <label>Rice(g):</label><input type="number" id="riceRate" value="100" oninput="recalculateAll()">
    <label>Cost(Rs):</label><input type="number" id="costRate" value="5.45" oninput="recalculateAll()">
    <button class="btn btn-clear" onclick="clearData()">üóëÔ∏è Clear</button>
    <button class="btn btn-print" onclick="window.print()">üñ®Ô∏è Print</button>
</div>

<div class="page">
    <div class="watermark"><svg viewBox="0 0 500 500"><text x="50%" y="50%" fill="#000" font-size="60" font-weight="bold" font-family="Arial" text-anchor="middle" transform="rotate(-45 250 250)">PM POSHAN</text><text x="50%" y="65%" fill="#000" font-size="40" font-family="Arial" text-anchor="middle" transform="rotate(-45 250 250)">W.B. GOVT</text></svg></div>

    <div class="header">
        <div class="logo"><img src="logo.png" alt="LOGO"></div>
        <div class="title-block">
            <h2>Cooked Mid Day Meal Programme</h2>
            <h3>School Education Department,</h3>
            <h3>Government of West Bengal Mid Day</h3>
            <h4>Meal Information System</h4>
        </div>
        <div class="form-box">FORM - C</div>
    </div>

    <div class="sub-header">MONTHLY COVERAGE REPORT OF COOKED MID DAY MEAL PROGRAMME (Form-C)<br><span style="font-weight: normal; font-size: 7.5pt;">[To be filled up in English Block Capital in only]</span></div>

    <div class="field-row"><div class="field-label">For the Month</div><input type="text" class="line-input" style="width: 100px; flex: none;" id="c_month"><div class="field-label" style="margin-left: 10px;">Year</div><input type="text" class="line-input" style="width: 50px; flex: none;" id="c_year"></div>
    <div class="field-row"><div class="field-label">District</div><div class="field-input"><input type="text" class="line-input" id="c_dist"></div><div class="field-label" style="margin-left: 10px;">Sub-Division</div><div class="field-input"><input type="text" class="line-input" id="c_subdiv"></div></div>
    <div class="field-row"><div class="field-label">Block/Municipality</div><div class="field-input"><input type="text" class="line-input" id="c_block"></div><div class="field-label" style="margin-left: 10px;">Name of G.P/Ward</div><div class="field-input"><input type="text" class="line-input" id="c_gp"></div></div>
    <div class="field-row"><div class="field-label">Name of School/ SSK/MSK/Madrasah</div><div class="field-input"><input type="text" class="line-input" id="c_school"></div></div>

    <div class="enrollment-section">
        <div class="enroll-row" style="justify-content: flex-start;"><div style="border: 1px solid #000; padding: 1px 4px; font-weight: bold; margin-right: 5px;">DISE Code</div><div class="box-group" id="dise_container"></div></div>
        <div class="enroll-row"><div>Enrolled students in class Bal Vatika :</div><div class="box-group" id="enr_bv"></div></div>
        <div class="split-row"><div class="half-row"><div>Enrolled Students in Class I/V :</div><div class="box-group" id="enr_iv"></div></div><div class="half-row"><div>Enrolled Students in Class II/VI :</div><div class="box-group" id="enr_iivi"></div></div></div>
        <div class="split-row"><div class="half-row"><div>Enrolled Students in Class III/VII :</div><div class="box-group" id="enr_iiivii"></div></div><div class="half-row"><div>Enrolled Students in Class IV/VIII :</div><div class="box-group" id="enr_ivviii"></div></div></div>
        <div class="enroll-row"><div>Enrolled students in Class V :</div><div class="box-group" id="enr_v"></div></div>
    </div>

    <table id="mainTable">
        <thead>
            <tr><th rowspan="3" class="col-sl">Sl.<br>No.</th><th rowspan="3" class="col-date">CMDM<br>Serving<br>Date</th><th colspan="12">No. of Children provided CMDM & Present for Pry/ Up Pry</th><th rowspan="3" style="width: 35px;">Rice<br>used<br>(KG)</th><th rowspan="3" style="width: 35px;">Cooking<br>Cost<br>(RS)</th><th rowspan="3" style="width: 60px;">Menu of<br>the day</th></tr>
            <tr><th colspan="2">Class Bal<br>Vatika</th><th colspan="2">Class<br>I/V</th><th colspan="2">Class<br>II/VI</th><th colspan="2">Class<br>III/VII</th><th colspan="2">Class<br>IV/VIII</th><th colspan="2" class="col-total">Total PP<br>to IV</th></tr>
            <tr><th>CP</th> <th>MT</th><th>CP</th> <th>MT</th><th>CP</th> <th>MT</th><th>CP</th> <th>MT</th><th>CP</th> <th>MT</th><th class="col-total">CP</th> <th class="col-total">MT</th></tr>
        </thead>
        <tbody></tbody>
        <tfoot>
            <tr style="font-weight: bold; background: #eee;"><td>Tot</td><td></td><td><input id="col_0_cp" class="readonly"></td> <td><input id="col_0_mt" class="readonly"></td><td><input id="col_1_cp" class="readonly"></td> <td><input id="col_1_mt" class="readonly"></td><td><input id="col_2_cp" class="readonly"></td> <td><input id="col_2_mt" class="readonly"></td><td><input id="col_3_cp" class="readonly"></td> <td><input id="col_3_mt" class="readonly"></td><td><input id="col_4_cp" class="readonly"></td> <td><input id="col_4_mt" class="readonly"></td><td class="col-total"><input id="grand_cp_total" class="readonly"></td> <td class="col-total"><input id="grand_mt_total" class="readonly"></td><td><input id="grand_rice" class="readonly"></td> <td><input id="grand_cost" class="readonly"></td> <td></td></tr>
        </tfoot>
    </table>

    <div class="footer">
        <div class="field-row">For Primary: Total CP: Class Bal Vatika <input id="summ_bv_cp" class="line-input footer-auto" style="width: 30px; flex: none;">, Total MT <input id="summ_bv_mt" class="line-input footer-auto" style="width: 30px; flex: none;"></div>
        <div class="field-row">For Primary: Total CP: Class I - IV <input id="summ_p_cp" class="line-input footer-auto" style="width: 50px; flex: none;">, Total MT : <input id="summ_p_mt" class="line-input footer-auto" style="width: 50px; flex: none;"></div>
        <div class="field-row">For Upper Primary: Total CP: Class V <input class="line-input" style="width: 50px; flex: none;">, Total MT : <input class="line-input" style="width: 50px; flex: none;"></div>
        <div class="field-row" style="padding-left: 50px;">Total CP: Class VI-VIII <input class="line-input" style="width: 50px; flex: none;">, Total MT : <input class="line-input" style="width: 50px; flex: none;"></div>
        <div style="margin-top: 5px;">CP : Children Present. MT : Mid Day Meal taker.</div>
        <div class="sig-block"><div class="sig-line">Signature of the HM/ HT with Seal</div></div>
        
        <div class="dev-watermark">Developed by Jyotirmoy Ghosh</div>
    </div>
</div>

<script>
    const tbody = document.querySelector('#mainTable tbody');
    const rowCount = 26;

    // --- SETUP ---
    window.onload = function() {
        createBoxes('dise_container', 11, 'dise');
        createBoxes('enr_bv', 4, 'enbv');
        createBoxes('enr_iv', 4, 'eniv');
        createBoxes('enr_iivi', 4, 'eniivi');
        createBoxes('enr_iiivii', 4, 'eniiivii');
        createBoxes('enr_ivviii', 4, 'enivviii');
        createBoxes('enr_v', 4, 'env');
        loadData(); 
    };

    function createBoxes(id, n, prefix) {
        let c = document.getElementById(id);
        for(let i=1; i<=n; i++) {
            let d = document.createElement('div');
            d.className = 'num-box';
            d.innerHTML = `<input id="${prefix}_${i}" maxlength="1" oninput="saveData()">`;
            c.appendChild(d);
        }
    }

    // --- TABLE GENERATION ---
    for (let i = 1; i <= rowCount; i++) {
        let tr = document.createElement('tr');
        tr.innerHTML = `<td>${i}</td><td><input type="date" id="date_${i}" style="font-size:7pt;" oninput="saveData()"></td>
            <td><input type="number" id="r${i}_g0_cp" class="val-in" data-r="${i}" data-g="0" data-t="cp" oninput="calc(${i})"></td><td><input type="number" id="r${i}_g0_mt" class="val-in" data-r="${i}" data-g="0" data-t="mt" oninput="calc(${i})"></td>
            <td><input type="number" id="r${i}_g1_cp" class="val-in" data-r="${i}" data-g="1" data-t="cp" oninput="calc(${i})"></td><td><input type="number" id="r${i}_g1_mt" class="val-in" data-r="${i}" data-g="1" data-t="mt" oninput="calc(${i})"></td>
            <td><input type="number" id="r${i}_g2_cp" class="val-in" data-r="${i}" data-g="2" data-t="cp" oninput="calc(${i})"></td><td><input type="number" id="r${i}_g2_mt" class="val-in" data-r="${i}" data-g="2" data-t="mt" oninput="calc(${i})"></td>
            <td><input type="number" id="r${i}_g3_cp" class="val-in" data-r="${i}" data-g="3" data-t="cp" oninput="calc(${i})"></td><td><input type="number" id="r${i}_g3_mt" class="val-in" data-r="${i}" data-g="3" data-t="mt" oninput="calc(${i})"></td>
            <td><input type="number" id="r${i}_g4_cp" class="val-in" data-r="${i}" data-g="4" data-t="cp" oninput="calc(${i})"></td><td><input type="number" id="r${i}_g4_mt" class="val-in" data-r="${i}" data-g="4" data-t="mt" oninput="calc(${i})"></td>
            <td class="col-total"><input id="r${i}_tot_cp" class="readonly" readonly></td><td class="col-total"><input id="r${i}_tot_mt" class="readonly" readonly></td>
            <td><input id="r${i}_rice" class="readonly" tabindex="-1"></td><td><input id="r${i}_cost" class="readonly" tabindex="-1"></td>
            <td><input type="text" id="menu_${i}" oninput="saveData()"></td>`;
        tbody.appendChild(tr);
    }

    // --- MATH ---
    function recalculateAll() { 
        saveData();
        for(let i=1; i<=rowCount; i++) calc(i, false); 
        updateGrandTotals();
    }

    function calc(rowIdx, shouldSave = true) {
        let rowCP = 0, rowMT = 0;
        for(let g=0; g<5; g++) {
            rowCP += parseFloat(document.getElementById(`r${rowIdx}_g${g}_cp`).value) || 0;
            rowMT += parseFloat(document.getElementById(`r${rowIdx}_g${g}_mt`).value) || 0;
        }
        document.getElementById(`r${rowIdx}_tot_cp`).value = rowCP || '';
        document.getElementById(`r${rowIdx}_tot_mt`).value = rowMT || '';
        
        let riceKg = (rowMT * (parseFloat(document.getElementById('riceRate').value) || 0)) / 1000;
        let costRs = (rowMT * (parseFloat(document.getElementById('costRate').value) || 0));
        document.getElementById(`r${rowIdx}_rice`).value = riceKg > 0 ? riceKg.toFixed(3) : '';
        document.getElementById(`r${rowIdx}_cost`).value = costRs > 0 ? costRs.toFixed(2) : '';
        
        updateGrandTotals();
        if(shouldSave) saveData();
    }

    function updateGrandTotals() {
        let colSumsCP = [0,0,0,0,0], colSumsMT = [0,0,0,0,0], grandTotCP = 0, grandTotMT = 0, grandRice = 0, grandCost = 0;
        for(let i=1; i<=rowCount; i++) {
            for(let g=0; g<5; g++) {
                let cp = parseFloat(document.getElementById(`r${i}_g${g}_cp`).value) || 0;
                let mt = parseFloat(document.getElementById(`r${i}_g${g}_mt`).value) || 0;
                colSumsCP[g] += cp; colSumsMT[g] += mt;
            }
            grandRice += parseFloat(document.getElementById(`r${i}_rice`).value) || 0;
            grandCost += parseFloat(document.getElementById(`r${i}_cost`).value) || 0;
        }
        for(let g=0; g<5; g++) {
            document.getElementById(`col_${g}_cp`).value = colSumsCP[g] || '';
            document.getElementById(`col_${g}_mt`).value = colSumsMT[g] || '';
            grandTotCP += colSumsCP[g]; grandTotMT += colSumsMT[g];
        }
        document.getElementById(`grand_cp_total`).value = grandTotCP || '';
        document.getElementById(`grand_mt_total`).value = grandTotMT || '';
        document.getElementById(`grand_rice`).value = grandRice > 0 ? grandRice.toFixed(3) : '';
        document.getElementById(`grand_cost`).value = grandCost > 0 ? grandCost.toFixed(2) : '';
        
        document.getElementById('summ_bv_cp').value = colSumsCP[0] || '';
        document.getElementById('summ_bv_mt').value = colSumsMT[0] || '';
        document.getElementById('summ_p_cp').value = (colSumsCP[1]+colSumsCP[2]+colSumsCP[3]+colSumsCP[4]) || '';
        document.getElementById('summ_p_mt').value = (colSumsMT[1]+colSumsMT[2]+colSumsMT[3]+colSumsMT[4]) || '';
    }

    // --- MEMORY ---
    function saveData() {
        let data = {};
        document.querySelectorAll('input').forEach(i => { if(i.id) data[i.id] = i.value; });
        localStorage.setItem('mdm_form_c_final', JSON.stringify(data));
    }
    function loadData() {
        let d = JSON.parse(localStorage.getItem('mdm_form_c_final'));
        if(d) {
            for(let k in d) if(document.getElementById(k)) document.getElementById(k).value = d[k];
            recalculateAll();
        }
    }
    function clearData() {
        if(confirm("Clear Data?")) { localStorage.removeItem('mdm_form_c_final'); location.reload(); }
    }
</script>
</body>
</html>
